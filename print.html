<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="src/utils/index.html">❱ utils</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="src/utils/interfaces/index.html">❱ interfaces</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="src/utils/interfaces/IRocketMinipool.sol/interface.RocketMinipoolInterface.html">RocketMinipoolInterface</a></li><li class="chapter-item "><a href="src/utils/interfaces/IRocketNodeDeposit.sol/interface.RocketNodeDepositInterface.html">RocketNodeDepositInterface</a></li><li class="chapter-item "><a href="src/utils/interfaces/IRocketNodeStaking.sol/interface.RocketNodeStakingInterface.html">RocketNodeStakingInterface</a></li><li class="chapter-item "><a href="src/utils/interfaces/IRocketStorage.sol/interface.RocketStorageInterface.html">RocketStorageInterface</a></li></ol></li><li class="chapter-item "><a href="src/utils/types/index.html">❱ types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="src/utils/types/MinipoolDeposit.sol/enum.MinipoolDeposit.html">MinipoolDeposit</a></li><li class="chapter-item "><a href="src/utils/types/MinipoolDetails.sol/struct.MinipoolDetails.html">MinipoolDetails</a></li><li class="chapter-item "><a href="src/utils/types/MinipoolStatus.sol/enum.MinipoolStatus.html">MinipoolStatus</a></li></ol></li><li class="chapter-item "><a href="src/utils/BlockscapeAccess.sol/abstract.BlockscapeAccess.html">BlockscapeAccess</a></li><li class="chapter-item "><a href="src/utils/BlockscapeErrors.sol/abstract.BlockscapeErrors.html">BlockscapeErrors</a></li><li class="chapter-item "><a href="src/utils/BlockscapeEvents.sol/abstract.BlockscapeEvents.html">BlockscapeEvents</a></li><li class="chapter-item "><a href="src/utils/BlockscapeShared.sol/abstract.BlockscapeShared.html">BlockscapeShared</a></li></ol></li><li class="chapter-item "><a href="src/BlockscapeETHStakeNFT.sol/contract.BlockscapeETHStakeNFT.html">BlockscapeETHStakeNFT</a></li><li class="chapter-item "><a href="src/BlockscapeValidatorNFT.sol/error.ValidatorAlreadySet.html">ValidatorAlreadySet</a></li><li class="chapter-item "><a href="src/BlockscapeValidatorNFT.sol/contract.BlockscapeValidatorNFT.html">BlockscapeValidatorNFT</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/BlockscapeNetwork/rocketscape" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="blockscape-rocketscape"><a class="header" href="#blockscape-rocketscape">Blockscape Rocketscape</a></h1>
<p>Blockscape Rocketscape is a smart contract solution that enables users to stake ETH and mint NFTs that represent their stake and rewards. Blockscape offers two types of NFTs: Blockscape Validator NFT and Blockscape ETH Stake NFT.</p>
<p>A Blockscape Validator NFT is issued to a user who stakes 16 ETH with Blockscape. This NFT represents a Validator on the Blockscape platform, which is transparent and traceable on the beacon chain. The user can monitor their validator performance, rewards, and penalties through the NFT. The user can also transfer or sell their NFT at any time, or reedem the NFT for an Validator exit subject to the Ethereum 2.0 staking rules and penalties.</p>
<p>The Blockscape ETH Stake NFT is issued to a user who stakes any amount of ETH with Blockscape. This NFT entitles the user to participate in a pool of stakers that are staking for them on the Blockscape platform. The user can also transfer or sell their NFT at any time, or reedem the NFT for a validator exit subject to the Ethereum staking rules and penalties.</p>
<p>Blockscape aims to provide a user-friendly and secure way for users to stake ETH and earn rewards, while also creating a new market for financial NFTs that have intrinsic value and utility</p>
<p>This project uses <a href="https://getfoundry.sh/">Foundry</a>. <code>MAINNET_RPC_URL</code> assumes to have a shell exported ethereum mainnet node endpoint url, e.g. through <code>export MAINNET_RPC_URL=https://mainnet.infura.io/v3/API_KEY</code>.</p>
<p>For more commands please consult <a href="./Makefile">the Makefile</a> where you can run commands by using <code>make</code> - e.g. <code>make test-coverage</code>.</p>
<h2 id="live-deployment"><a class="header" href="#live-deployment">Live Deployment</a></h2>
<p>Goerli Playground <a href="https://stakedev.blockscape.network/pstake/ETH/solo/">https://stakedev.blockscape.network/pstake/ETH/solo/</a></p>
<h2 id="deploy-by-yourself"><a class="header" href="#deploy-by-yourself">Deploy by yourself</a></h2>
<p><code>forge script script/DeployGoerli_BlockscapeValidatorNFTGoerli.s.sol --fork-url $GOERLI_RPC_URL --broadcast --verify --optimize</code></p>
<h2 id="workflow-diagram-blockscape-validator-nft"><a class="header" href="#workflow-diagram-blockscape-validator-nft">Workflow Diagram: Blockscape Validator NFT</a></h2>
<p><img src="https://i.ibb.co/6DdcbgV/Screenshot-2023-02-21-at-09-50-53.png" alt="Blockscape Validator NFT" /></p>
<h2 id="workflow-diagram-blockscape-eth-stake-nft"><a class="header" href="#workflow-diagram-blockscape-eth-stake-nft">Workflow Diagram: Blockscape ETH Stake NFT</a></h2>
<p><img src="https://i.ibb.co/L8dVt7K/Screenshot-2023-02-21-at-09-51-01.png" alt="Blockscape ETH Stake NFT" /></p>
<h2 id="run-test-locally"><a class="header" href="#run-test-locally">Run test locally</a></h2>
<pre><code class="language-shell">forge test -vv --fork-url $MAINNET_RPC_URL --fork-block-number=16376809 --match-contract BlockscapeValidatorNFT
</code></pre>
<h2 id="git-clone"><a class="header" href="#git-clone">Git Clone</a></h2>
<p>Please clone the repo with <code>--recursive</code> flag to clone the submodules.</p>
<pre><code class="language-shell">git clone --recursive https://github.com/BlockscapeNetwork/rocketscape
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents"><a class="header" href="#contents">Contents</a></h1>
<ul>
<li><a href="src/utils//src/utils/interfaces">interfaces</a></li>
<li><a href="src/utils//src/utils/types">types</a></li>
<li><a href="src/utils/BlockscapeAccess.sol/abstract.BlockscapeAccess.html">BlockscapeAccess</a></li>
<li><a href="src/utils/BlockscapeErrors.sol/abstract.BlockscapeErrors.html">BlockscapeErrors</a></li>
<li><a href="src/utils/BlockscapeEvents.sol/abstract.BlockscapeEvents.html">BlockscapeEvents</a></li>
<li><a href="src/utils/BlockscapeShared.sol/abstract.BlockscapeShared.html">BlockscapeShared</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-1"><a class="header" href="#contents-1">Contents</a></h1>
<ul>
<li><a href="src/utils/interfaces/IRocketMinipool.sol/interface.RocketMinipoolInterface.html">RocketMinipoolInterface</a></li>
<li><a href="src/utils/interfaces/IRocketNodeDeposit.sol/interface.RocketNodeDepositInterface.html">RocketNodeDepositInterface</a></li>
<li><a href="src/utils/interfaces/IRocketNodeStaking.sol/interface.RocketNodeStakingInterface.html">RocketNodeStakingInterface</a></li>
<li><a href="src/utils/interfaces/IRocketStorage.sol/interface.RocketStorageInterface.html">RocketStorageInterface</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rocketminipoolinterface"><a class="header" href="#rocketminipoolinterface">RocketMinipoolInterface</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/utils/interfaces/IRocketMinipool.sol">Git Source</a></p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="initialise"><a class="header" href="#initialise">initialise</a></h3>
<pre><code class="language-solidity">function initialise(address _nodeAddress, MinipoolDeposit _depositType) external;
</code></pre>
<h3 id="getstatus"><a class="header" href="#getstatus">getStatus</a></h3>
<pre><code class="language-solidity">function getStatus() external view returns (MinipoolStatus);
</code></pre>
<h3 id="getfinalised"><a class="header" href="#getfinalised">getFinalised</a></h3>
<pre><code class="language-solidity">function getFinalised() external view returns (bool);
</code></pre>
<h3 id="getstatusblock"><a class="header" href="#getstatusblock">getStatusBlock</a></h3>
<pre><code class="language-solidity">function getStatusBlock() external view returns (uint256);
</code></pre>
<h3 id="getstatustime"><a class="header" href="#getstatustime">getStatusTime</a></h3>
<pre><code class="language-solidity">function getStatusTime() external view returns (uint256);
</code></pre>
<h3 id="getscrubvoted"><a class="header" href="#getscrubvoted">getScrubVoted</a></h3>
<pre><code class="language-solidity">function getScrubVoted(address _member) external view returns (bool);
</code></pre>
<h3 id="getdeposittype"><a class="header" href="#getdeposittype">getDepositType</a></h3>
<pre><code class="language-solidity">function getDepositType() external view returns (MinipoolDeposit);
</code></pre>
<h3 id="getnodeaddress"><a class="header" href="#getnodeaddress">getNodeAddress</a></h3>
<pre><code class="language-solidity">function getNodeAddress() external view returns (address);
</code></pre>
<h3 id="getnodefee"><a class="header" href="#getnodefee">getNodeFee</a></h3>
<pre><code class="language-solidity">function getNodeFee() external view returns (uint256);
</code></pre>
<h3 id="getnodedepositbalance"><a class="header" href="#getnodedepositbalance">getNodeDepositBalance</a></h3>
<pre><code class="language-solidity">function getNodeDepositBalance() external view returns (uint256);
</code></pre>
<h3 id="getnoderefundbalance"><a class="header" href="#getnoderefundbalance">getNodeRefundBalance</a></h3>
<pre><code class="language-solidity">function getNodeRefundBalance() external view returns (uint256);
</code></pre>
<h3 id="getnodedepositassigned"><a class="header" href="#getnodedepositassigned">getNodeDepositAssigned</a></h3>
<pre><code class="language-solidity">function getNodeDepositAssigned() external view returns (bool);
</code></pre>
<h3 id="getuserdepositbalance"><a class="header" href="#getuserdepositbalance">getUserDepositBalance</a></h3>
<pre><code class="language-solidity">function getUserDepositBalance() external view returns (uint256);
</code></pre>
<h3 id="getuserdepositassigned"><a class="header" href="#getuserdepositassigned">getUserDepositAssigned</a></h3>
<pre><code class="language-solidity">function getUserDepositAssigned() external view returns (bool);
</code></pre>
<h3 id="getuserdepositassignedtime"><a class="header" href="#getuserdepositassignedtime">getUserDepositAssignedTime</a></h3>
<pre><code class="language-solidity">function getUserDepositAssignedTime() external view returns (uint256);
</code></pre>
<h3 id="gettotalscrubvotes"><a class="header" href="#gettotalscrubvotes">getTotalScrubVotes</a></h3>
<pre><code class="language-solidity">function getTotalScrubVotes() external view returns (uint256);
</code></pre>
<h3 id="calculatenodeshare"><a class="header" href="#calculatenodeshare">calculateNodeShare</a></h3>
<pre><code class="language-solidity">function calculateNodeShare(uint256 _balance) external view returns (uint256);
</code></pre>
<h3 id="calculateusershare"><a class="header" href="#calculateusershare">calculateUserShare</a></h3>
<pre><code class="language-solidity">function calculateUserShare(uint256 _balance) external view returns (uint256);
</code></pre>
<h3 id="nodedeposit"><a class="header" href="#nodedeposit">nodeDeposit</a></h3>
<pre><code class="language-solidity">function nodeDeposit(bytes calldata _validatorPubkey, bytes calldata _validatorSignature, bytes32 _depositDataRoot)
    external
    payable;
</code></pre>
<h3 id="userdeposit"><a class="header" href="#userdeposit">userDeposit</a></h3>
<pre><code class="language-solidity">function userDeposit() external payable;
</code></pre>
<h3 id="distributebalance"><a class="header" href="#distributebalance">distributeBalance</a></h3>
<pre><code class="language-solidity">function distributeBalance() external;
</code></pre>
<h3 id="distributebalanceandfinalise"><a class="header" href="#distributebalanceandfinalise">distributeBalanceAndFinalise</a></h3>
<pre><code class="language-solidity">function distributeBalanceAndFinalise() external;
</code></pre>
<h3 id="refund"><a class="header" href="#refund">refund</a></h3>
<pre><code class="language-solidity">function refund() external;
</code></pre>
<h3 id="slash"><a class="header" href="#slash">slash</a></h3>
<pre><code class="language-solidity">function slash() external;
</code></pre>
<h3 id="finalise"><a class="header" href="#finalise">finalise</a></h3>
<pre><code class="language-solidity">function finalise() external;
</code></pre>
<h3 id="canstake"><a class="header" href="#canstake">canStake</a></h3>
<pre><code class="language-solidity">function canStake() external view returns (bool);
</code></pre>
<h3 id="stake"><a class="header" href="#stake">stake</a></h3>
<pre><code class="language-solidity">function stake(bytes calldata _validatorSignature, bytes32 _depositDataRoot) external;
</code></pre>
<h3 id="setwithdrawable"><a class="header" href="#setwithdrawable">setWithdrawable</a></h3>
<pre><code class="language-solidity">function setWithdrawable() external;
</code></pre>
<h3 id="dissolve"><a class="header" href="#dissolve">dissolve</a></h3>
<pre><code class="language-solidity">function dissolve() external;
</code></pre>
<h3 id="close"><a class="header" href="#close">close</a></h3>
<pre><code class="language-solidity">function close() external;
</code></pre>
<h3 id="votescrub"><a class="header" href="#votescrub">voteScrub</a></h3>
<pre><code class="language-solidity">function voteScrub() external;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rocketnodedepositinterface"><a class="header" href="#rocketnodedepositinterface">RocketNodeDepositInterface</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/utils/interfaces/IRocketNodeDeposit.sol">Git Source</a></p>
<h2 id="functions-1"><a class="header" href="#functions-1">Functions</a></h2>
<h3 id="deposit"><a class="header" href="#deposit">deposit</a></h3>
<pre><code class="language-solidity">function deposit(
    uint256 _minimumNodeFee,
    bytes calldata _validatorPubkey,
    bytes calldata _validatorSignature,
    bytes32 _depositDataRoot,
    uint256 _salt,
    address _expectedMinipoolAddress
) external payable;
</code></pre>
<h3 id="getdeposittype-1"><a class="header" href="#getdeposittype-1">getDepositType</a></h3>
<pre><code class="language-solidity">function getDepositType(uint256 _amount) external view returns (MinipoolDeposit);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rocketnodestakinginterface"><a class="header" href="#rocketnodestakinginterface">RocketNodeStakingInterface</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/utils/interfaces/IRocketNodeStaking.sol">Git Source</a></p>
<h2 id="functions-2"><a class="header" href="#functions-2">Functions</a></h2>
<h3 id="gettotalrplstake"><a class="header" href="#gettotalrplstake">getTotalRPLStake</a></h3>
<pre><code class="language-solidity">function getTotalRPLStake() external view returns (uint256);
</code></pre>
<h3 id="getnoderplstake"><a class="header" href="#getnoderplstake">getNodeRPLStake</a></h3>
<pre><code class="language-solidity">function getNodeRPLStake(address _nodeAddress) external view returns (uint256);
</code></pre>
<h3 id="getnoderplstakedtime"><a class="header" href="#getnoderplstakedtime">getNodeRPLStakedTime</a></h3>
<pre><code class="language-solidity">function getNodeRPLStakedTime(address _nodeAddress) external view returns (uint256);
</code></pre>
<h3 id="gettotaleffectiverplstake"><a class="header" href="#gettotaleffectiverplstake">getTotalEffectiveRPLStake</a></h3>
<pre><code class="language-solidity">function getTotalEffectiveRPLStake() external view returns (uint256);
</code></pre>
<h3 id="calculatetotaleffectiverplstake"><a class="header" href="#calculatetotaleffectiverplstake">calculateTotalEffectiveRPLStake</a></h3>
<pre><code class="language-solidity">function calculateTotalEffectiveRPLStake(uint256 offset, uint256 limit, uint256 rplPrice)
    external
    view
    returns (uint256);
</code></pre>
<h3 id="getnodeeffectiverplstake"><a class="header" href="#getnodeeffectiverplstake">getNodeEffectiveRPLStake</a></h3>
<pre><code class="language-solidity">function getNodeEffectiveRPLStake(address _nodeAddress) external view returns (uint256);
</code></pre>
<h3 id="getnodeminimumrplstake"><a class="header" href="#getnodeminimumrplstake">getNodeMinimumRPLStake</a></h3>
<pre><code class="language-solidity">function getNodeMinimumRPLStake(address _nodeAddress) external view returns (uint256);
</code></pre>
<h3 id="getnodemaximumrplstake"><a class="header" href="#getnodemaximumrplstake">getNodeMaximumRPLStake</a></h3>
<pre><code class="language-solidity">function getNodeMaximumRPLStake(address _nodeAddress) external view returns (uint256);
</code></pre>
<h3 id="getnodeminipoollimit"><a class="header" href="#getnodeminipoollimit">getNodeMinipoolLimit</a></h3>
<pre><code class="language-solidity">function getNodeMinipoolLimit(address _nodeAddress) external view returns (uint256);
</code></pre>
<h3 id="stakerpl"><a class="header" href="#stakerpl">stakeRPL</a></h3>
<pre><code class="language-solidity">function stakeRPL(uint256 _amount) external;
</code></pre>
<h3 id="stakerplfor"><a class="header" href="#stakerplfor">stakeRPLFor</a></h3>
<pre><code class="language-solidity">function stakeRPLFor(address _nodeAddress, uint256 _amount) external;
</code></pre>
<h3 id="withdrawrpl"><a class="header" href="#withdrawrpl">withdrawRPL</a></h3>
<pre><code class="language-solidity">function withdrawRPL(uint256 _amount) external;
</code></pre>
<h3 id="slashrpl"><a class="header" href="#slashrpl">slashRPL</a></h3>
<pre><code class="language-solidity">function slashRPL(address _nodeAddress, uint256 _ethSlashAmount) external;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rocketstorageinterface"><a class="header" href="#rocketstorageinterface">RocketStorageInterface</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/utils/interfaces/IRocketStorage.sol">Git Source</a></p>
<h2 id="functions-3"><a class="header" href="#functions-3">Functions</a></h2>
<h3 id="getdeployedstatus"><a class="header" href="#getdeployedstatus">getDeployedStatus</a></h3>
<pre><code class="language-solidity">function getDeployedStatus() external view returns (bool);
</code></pre>
<h3 id="getguardian"><a class="header" href="#getguardian">getGuardian</a></h3>
<pre><code class="language-solidity">function getGuardian() external view returns (address);
</code></pre>
<h3 id="setguardian"><a class="header" href="#setguardian">setGuardian</a></h3>
<pre><code class="language-solidity">function setGuardian(address _newAddress) external;
</code></pre>
<h3 id="confirmguardian"><a class="header" href="#confirmguardian">confirmGuardian</a></h3>
<pre><code class="language-solidity">function confirmGuardian() external;
</code></pre>
<h3 id="getaddress"><a class="header" href="#getaddress">getAddress</a></h3>
<pre><code class="language-solidity">function getAddress(bytes32 _key) external view returns (address);
</code></pre>
<h3 id="getuint"><a class="header" href="#getuint">getUint</a></h3>
<pre><code class="language-solidity">function getUint(bytes32 _key) external view returns (uint256);
</code></pre>
<h3 id="getstring"><a class="header" href="#getstring">getString</a></h3>
<pre><code class="language-solidity">function getString(bytes32 _key) external view returns (string memory);
</code></pre>
<h3 id="getbytes"><a class="header" href="#getbytes">getBytes</a></h3>
<pre><code class="language-solidity">function getBytes(bytes32 _key) external view returns (bytes memory);
</code></pre>
<h3 id="getbool"><a class="header" href="#getbool">getBool</a></h3>
<pre><code class="language-solidity">function getBool(bytes32 _key) external view returns (bool);
</code></pre>
<h3 id="getint"><a class="header" href="#getint">getInt</a></h3>
<pre><code class="language-solidity">function getInt(bytes32 _key) external view returns (int256);
</code></pre>
<h3 id="getbytes32"><a class="header" href="#getbytes32">getBytes32</a></h3>
<pre><code class="language-solidity">function getBytes32(bytes32 _key) external view returns (bytes32);
</code></pre>
<h3 id="setaddress"><a class="header" href="#setaddress">setAddress</a></h3>
<pre><code class="language-solidity">function setAddress(bytes32 _key, address _value) external;
</code></pre>
<h3 id="setuint"><a class="header" href="#setuint">setUint</a></h3>
<pre><code class="language-solidity">function setUint(bytes32 _key, uint256 _value) external;
</code></pre>
<h3 id="setstring"><a class="header" href="#setstring">setString</a></h3>
<pre><code class="language-solidity">function setString(bytes32 _key, string calldata _value) external;
</code></pre>
<h3 id="setbytes"><a class="header" href="#setbytes">setBytes</a></h3>
<pre><code class="language-solidity">function setBytes(bytes32 _key, bytes calldata _value) external;
</code></pre>
<h3 id="setbool"><a class="header" href="#setbool">setBool</a></h3>
<pre><code class="language-solidity">function setBool(bytes32 _key, bool _value) external;
</code></pre>
<h3 id="setint"><a class="header" href="#setint">setInt</a></h3>
<pre><code class="language-solidity">function setInt(bytes32 _key, int256 _value) external;
</code></pre>
<h3 id="setbytes32"><a class="header" href="#setbytes32">setBytes32</a></h3>
<pre><code class="language-solidity">function setBytes32(bytes32 _key, bytes32 _value) external;
</code></pre>
<h3 id="deleteaddress"><a class="header" href="#deleteaddress">deleteAddress</a></h3>
<pre><code class="language-solidity">function deleteAddress(bytes32 _key) external;
</code></pre>
<h3 id="deleteuint"><a class="header" href="#deleteuint">deleteUint</a></h3>
<pre><code class="language-solidity">function deleteUint(bytes32 _key) external;
</code></pre>
<h3 id="deletestring"><a class="header" href="#deletestring">deleteString</a></h3>
<pre><code class="language-solidity">function deleteString(bytes32 _key) external;
</code></pre>
<h3 id="deletebytes"><a class="header" href="#deletebytes">deleteBytes</a></h3>
<pre><code class="language-solidity">function deleteBytes(bytes32 _key) external;
</code></pre>
<h3 id="deletebool"><a class="header" href="#deletebool">deleteBool</a></h3>
<pre><code class="language-solidity">function deleteBool(bytes32 _key) external;
</code></pre>
<h3 id="deleteint"><a class="header" href="#deleteint">deleteInt</a></h3>
<pre><code class="language-solidity">function deleteInt(bytes32 _key) external;
</code></pre>
<h3 id="deletebytes32"><a class="header" href="#deletebytes32">deleteBytes32</a></h3>
<pre><code class="language-solidity">function deleteBytes32(bytes32 _key) external;
</code></pre>
<h3 id="adduint"><a class="header" href="#adduint">addUint</a></h3>
<pre><code class="language-solidity">function addUint(bytes32 _key, uint256 _amount) external;
</code></pre>
<h3 id="subuint"><a class="header" href="#subuint">subUint</a></h3>
<pre><code class="language-solidity">function subUint(bytes32 _key, uint256 _amount) external;
</code></pre>
<h3 id="getnodewithdrawaladdress"><a class="header" href="#getnodewithdrawaladdress">getNodeWithdrawalAddress</a></h3>
<pre><code class="language-solidity">function getNodeWithdrawalAddress(address _nodeAddress) external view returns (address);
</code></pre>
<h3 id="getnodependingwithdrawaladdress"><a class="header" href="#getnodependingwithdrawaladdress">getNodePendingWithdrawalAddress</a></h3>
<pre><code class="language-solidity">function getNodePendingWithdrawalAddress(address _nodeAddress) external view returns (address);
</code></pre>
<h3 id="setwithdrawaladdress"><a class="header" href="#setwithdrawaladdress">setWithdrawalAddress</a></h3>
<pre><code class="language-solidity">function setWithdrawalAddress(address _nodeAddress, address _newWithdrawalAddress, bool _confirm) external;
</code></pre>
<h3 id="confirmwithdrawaladdress"><a class="header" href="#confirmwithdrawaladdress">confirmWithdrawalAddress</a></h3>
<pre><code class="language-solidity">function confirmWithdrawalAddress(address _nodeAddress) external;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents-2"><a class="header" href="#contents-2">Contents</a></h1>
<ul>
<li><a href="src/utils/types/MinipoolDeposit.sol/enum.MinipoolDeposit.html">MinipoolDeposit</a></li>
<li><a href="src/utils/types/MinipoolDetails.sol/struct.MinipoolDetails.html">MinipoolDetails</a></li>
<li><a href="src/utils/types/MinipoolStatus.sol/enum.MinipoolStatus.html">MinipoolStatus</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minipooldeposit"><a class="header" href="#minipooldeposit">MinipoolDeposit</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/utils/types/MinipoolDeposit.sol">Git Source</a></p>
<pre><code class="language-solidity">enum MinipoolDeposit {
    None,
    Full,
    Half,
    Empty
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minipooldetails"><a class="header" href="#minipooldetails">MinipoolDetails</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/utils/types/MinipoolDetails.sol">Git Source</a></p>
<pre><code class="language-solidity">struct MinipoolDetails {
    bool exists;
    address minipoolAddress;
    bytes pubkey;
    MinipoolStatus status;
    uint256 statusBlock;
    uint256 statusTime;
    bool finalised;
    MinipoolDeposit depositType;
    uint256 nodeFee;
    uint256 nodeDepositBalance;
    bool nodeDepositAssigned;
    uint256 userDepositBalance;
    bool userDepositAssigned;
    uint256 userDepositAssignedTime;
    bool useLatestDelegate;
    address delegate;
    address previousDelegate;
    address effectiveDelegate;
    uint256 penaltyCount;
    uint256 penaltyRate;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minipoolstatus"><a class="header" href="#minipoolstatus">MinipoolStatus</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/utils/types/MinipoolStatus.sol">Git Source</a></p>
<pre><code class="language-solidity">enum MinipoolStatus {
    Initialised,
    Prelaunch,
    Staking,
    Withdrawable,
    Dissolved
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="blockscapeaccess"><a class="header" href="#blockscapeaccess">BlockscapeAccess</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/utils/BlockscapeAccess.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
AccessControl</p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="adj_config_role"><a class="header" href="#adj_config_role">ADJ_CONFIG_ROLE</a></h3>
<p><em>role to adjust the config of the smart contract parameters</em></p>
<pre><code class="language-solidity">bytes32 internal constant ADJ_CONFIG_ROLE = keccak256(&quot;ADJ_CONFIG_ROLE&quot;);
</code></pre>
<h3 id="rp_backend_role"><a class="header" href="#rp_backend_role">RP_BACKEND_ROLE</a></h3>
<p><em>role for the backendController executer</em></p>
<pre><code class="language-solidity">bytes32 internal constant RP_BACKEND_ROLE = keccak256(&quot;RP_BACKEND_ROLE&quot;);
</code></pre>
<h3 id="emergency_role"><a class="header" href="#emergency_role">EMERGENCY_ROLE</a></h3>
<p><em>role to open / close vault in cases of emergencies</em></p>
<pre><code class="language-solidity">bytes32 internal constant EMERGENCY_ROLE = keccak256(&quot;EMERGENCY_ROLE&quot;);
</code></pre>
<h2 id="functions-4"><a class="header" href="#functions-4">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<pre><code class="language-solidity">constructor(address adj_config_role, address rp_backend_role, address emergency_role);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="blockscapeerrors"><a class="header" href="#blockscapeerrors">BlockscapeErrors</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/utils/BlockscapeErrors.sol">Git Source</a></p>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="errorvaultstate"><a class="header" href="#errorvaultstate">ErrorVaultState</a></h3>
<p><em>The vault is in the wrong state</em></p>
<pre><code class="language-solidity">error ErrorVaultState(bool _isOpen);
</code></pre>
<h3 id="notenoughrplstake"><a class="header" href="#notenoughrplstake">NotEnoughRPLStake</a></h3>
<p><em>more RPL stake has to be done in order to open vault</em></p>
<pre><code class="language-solidity">error NotEnoughRPLStake();
</code></pre>
<h3 id="incorrectdepositvaluesent"><a class="header" href="#incorrectdepositvaluesent">IncorrectDepositValueSent</a></h3>
<p><em>Deposit value needs to align with RP poolsizes as specified in <code>curETHlimit</code></em></p>
<pre><code class="language-solidity">error IncorrectDepositValueSent();
</code></pre>
<h3 id="alreadypreparingforwithdrawal"><a class="header" href="#alreadypreparingforwithdrawal">AlreadyPreparingForWithdrawal</a></h3>
<p><em>The vault is already preparing for withdrawal</em></p>
<pre><code class="language-solidity">error AlreadyPreparingForWithdrawal();
</code></pre>
<h3 id="withdrawaltimelocknotreached"><a class="header" href="#withdrawaltimelocknotreached">WithdrawalTimelockNotReached</a></h3>
<p><em>The withdrawal has a timelock which is not yet reached</em></p>
<pre><code class="language-solidity">error WithdrawalTimelockNotReached(uint256 unlockTimestamp);
</code></pre>
<h3 id="youdontownthisnft"><a class="header" href="#youdontownthisnft">YouDontOwnThisNft</a></h3>
<p><em>user does not own the NFT</em></p>
<pre><code class="language-solidity">error YouDontOwnThisNft(uint256 _tokenID);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="blockscapeevents"><a class="header" href="#blockscapeevents">BlockscapeEvents</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/utils/BlockscapeEvents.sol">Git Source</a></p>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="stakeupdated"><a class="header" href="#stakeupdated">StakeUpdated</a></h3>
<p><em>event for when the NFT stake is updated</em></p>
<pre><code class="language-solidity">event StakeUpdated(uint256 indexed _tokenID, address indexed _owner, uint256 _newStake);
</code></pre>
<h3 id="ethlimitchanged"><a class="header" href="#ethlimitchanged">ETHLimitChanged</a></h3>
<p><em>event for when the ETH limit is changed</em></p>
<pre><code class="language-solidity">event ETHLimitChanged(uint256 _newLimit);
</code></pre>
<h3 id="userrequestedwithdrawalvali"><a class="header" href="#userrequestedwithdrawalvali">UserRequestedWithdrawalVali</a></h3>
<p><em>event for when a user requests a withdrawal for a Validator NFT</em></p>
<pre><code class="language-solidity">event UserRequestedWithdrawalVali(
    uint256 indexed _tokenID, address indexed _user, uint256 _fee, uint256 _stakedETH, uint256 _rewards
);
</code></pre>
<h3 id="userrequestedwithdrawalstake"><a class="header" href="#userrequestedwithdrawalstake">UserRequestedWithdrawalStake</a></h3>
<p><em>event for when a user requests a withdrawal for a Stake ETH NFT</em></p>
<pre><code class="language-solidity">event UserRequestedWithdrawalStake(
    uint256 indexed _tokenID, address indexed _user, uint256 _stakedETH, uint256 _rewards
);
</code></pre>
<h3 id="rocketpoolnodeaddresschanged"><a class="header" href="#rocketpoolnodeaddresschanged">RocketPoolNodeAddressChanged</a></h3>
<p><em>event for when the RocketPool Node Address is changed</em></p>
<pre><code class="language-solidity">event RocketPoolNodeAddressChanged(address _newAddress);
</code></pre>
<h3 id="withdrawfeechanged"><a class="header" href="#withdrawfeechanged">WithdrawFeeChanged</a></h3>
<p><em>event for when the withdraw fee is changed</em></p>
<pre><code class="language-solidity">event WithdrawFeeChanged(uint256 _newFee);
</code></pre>
<h3 id="timelockwithdrawchanged"><a class="header" href="#timelockwithdrawchanged">TimelockWithdrawChanged</a></h3>
<p><em>event for when the timelock for a withdrawal is changed</em></p>
<pre><code class="language-solidity">event TimelockWithdrawChanged(uint256 _newTimelock);
</code></pre>
<h3 id="emergencyvaultstatechanged"><a class="header" href="#emergencyvaultstatechanged">EmergencyVaultStateChanged</a></h3>
<p><em>event for when the vault is opened / closed in case of emergency</em></p>
<pre><code class="language-solidity">event EmergencyVaultStateChanged(bool _isOpen);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="blockscapeshared"><a class="header" href="#blockscapeshared">BlockscapeShared</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/utils/BlockscapeShared.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="src/utils/BlockscapeShared.sol//src/utils/BlockscapeAccess.sol/abstract.BlockscapeAccess.html">BlockscapeAccess</a>, <a href="src/utils/BlockscapeShared.sol//src/utils/BlockscapeErrors.sol/abstract.BlockscapeErrors.html">BlockscapeErrors</a>, <a href="src/utils/BlockscapeShared.sol//src/utils/BlockscapeEvents.sol/abstract.BlockscapeEvents.html">BlockscapeEvents</a></p>
<h2 id="state-variables-1"><a class="header" href="#state-variables-1">State Variables</a></h2>
<h3 id="vaultopen"><a class="header" href="#vaultopen">vaultOpen</a></h3>
<p><em>using OZs sendValue implementation</em></p>
<p><em>the initial vault state is open</em></p>
<pre><code class="language-solidity">bool internal vaultOpen = true;
</code></pre>
<h3 id="rpcomm8"><a class="header" href="#rpcomm8">rpComm8</a></h3>
<p>current initial RP commission for 8 ETH minipools, public for transparency</p>
<pre><code class="language-solidity">uint256 public rpComm8 = 14;
</code></pre>
<h3 id="blockscaperocketpoolnode"><a class="header" href="#blockscaperocketpoolnode">blockscapeRocketPoolNode</a></h3>
<p>Blockscape Rocket Pool Node Address, public for transparency</p>
<pre><code class="language-solidity">address payable public blockscapeRocketPoolNode = payable(0xF6132f532ABc3902EA2DcaE7f8D7FCCdF7Ba4982);
</code></pre>
<h3 id="tokenid"><a class="header" href="#tokenid">tokenID</a></h3>
<p>initial tokenID</p>
<p><em>the tokenID is used to identify the NFTs</em></p>
<pre><code class="language-solidity">uint256 internal tokenID = 1;
</code></pre>
<h3 id="timelockwithdraw"><a class="header" href="#timelockwithdraw">timelockWithdraw</a></h3>
<p><em>the current timelock for a withdrawal request, public for transparency</em></p>
<pre><code class="language-solidity">uint256 public timelockWithdraw = 7 days;
</code></pre>
<h3 id="initwithdrawfee"><a class="header" href="#initwithdrawfee">initWithdrawFee</a></h3>
<p>current initial withdraw fee, public for transparency</p>
<pre><code class="language-solidity">uint256 public initWithdrawFee = 20 * 1e18;
</code></pre>
<h3 id="sendertotimestamp"><a class="header" href="#sendertotimestamp">senderToTimestamp</a></h3>
<p><em>Mapping withdrawal requester to timestamp of request to keep record, public for use in UI</em></p>
<pre><code class="language-solidity">mapping(address =&gt; uint256) public senderToTimestamp;
</code></pre>
<h3 id="tokenidtometadata"><a class="header" href="#tokenidtometadata">tokenIDtoMetadata</a></h3>
<p><em>Mappings of tokenID to Metadata</em></p>
<pre><code class="language-solidity">mapping(uint256 =&gt; Metadata) internal tokenIDtoMetadata;
</code></pre>
<h3 id="tokenidtoexitreward"><a class="header" href="#tokenidtoexitreward">tokenIDToExitReward</a></h3>
<p><em>Mappings of tokenID to the final exit reward for the staker</em></p>
<pre><code class="language-solidity">mapping(uint256 =&gt; uint256) public tokenIDToExitReward;
</code></pre>
<h3 id="rocket_storage"><a class="header" href="#rocket_storage">ROCKET_STORAGE</a></h3>
<p><em>RocketStorageInterface of rocketpool</em></p>
<pre><code class="language-solidity">RocketStorageInterface internal constant ROCKET_STORAGE =
    RocketStorageInterface(0x1d8f8f00cfa6758d7bE78336684788Fb0ee0Fa46);
</code></pre>
<h2 id="functions-5"><a class="header" href="#functions-5">Functions</a></h2>
<h3 id="getavailablerplstake"><a class="header" href="#getavailablerplstake">getAvailableRPLStake</a></h3>
<p>show the currently available RPL stake which is needed to create
a pool on rocketscape</p>
<pre><code class="language-solidity">function getAvailableRPLStake() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>the current available RPL stake with already deducted minimum stake</td></tr>
</tbody></table>
<h3 id="getlatestrocketnodestaking"><a class="header" href="#getlatestrocketnodestaking">getLatestRocketNodeStaking</a></h3>
<p><em>rocketpool contract interface for interactions with the rocketNodeStaking contract</em></p>
<pre><code class="language-solidity">function getLatestRocketNodeStaking() internal view returns (RocketNodeStakingInterface);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>RocketNodeStakingInterface</code></td><td>the rocketNodeStaking contract interface</td></tr>
</tbody></table>
<h3 id="getreqrplstake"><a class="header" href="#getreqrplstake">getReqRPLStake</a></h3>
<p>calculates the required RPL needed to stake according to
poolsize</p>
<p><em>if the minipoollimit is <code>0</code> then the required stake is also <code>0</code>!</em></p>
<pre><code class="language-solidity">function getReqRPLStake() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>the RPLs needed</td></tr>
</tbody></table>
<h3 id="hasnodeenoughrplstake"><a class="header" href="#hasnodeenoughrplstake">hasNodeEnoughRPLStake</a></h3>
<p>has the node enough RPL to stake another minipool</p>
<pre><code class="language-solidity">function hasNodeEnoughRPLStake() public view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>true if the node has enough RPL to stake another minipool</td></tr>
</tbody></table>
<h3 id="setblockscaperocketpoolnode"><a class="header" href="#setblockscaperocketpoolnode">setBlockscapeRocketPoolNode</a></h3>
<p>gets used if blockscape changes the address of their rp node</p>
<pre><code class="language-solidity">function setBlockscapeRocketPoolNode(address _newBlockscapeRocketPoolNode) external onlyRole(ADJ_CONFIG_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_newBlockscapeRocketPoolNode</code></td><td><code>address</code></td><td>the new address of the rocketpool node</td></tr>
</tbody></table>
<h3 id="_setmetadataforstakeinternal"><a class="header" href="#_setmetadataforstakeinternal">_setMetadataForStakeInternal</a></h3>
<p>sets the stakedETH and stakedTimestamp for a given tokenID inm the Metadata struct</p>
<pre><code class="language-solidity">function _setMetadataForStakeInternal(uint256 _stakedETH, uint256 _tokenID) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_stakedETH</code></td><td><code>uint256</code></td><td>the amount of ETH staked</td></tr>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>the tokenID of the NFT</td></tr>
</tbody></table>
<h3 id="gettokenid"><a class="header" href="#gettokenid">getTokenID</a></h3>
<p>the tokenID is incremented with every pool</p>
<pre><code class="language-solidity">function getTokenID() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>the current tokenID</td></tr>
</tbody></table>
<h3 id="getbalance"><a class="header" href="#getbalance">getBalance</a></h3>
<p>how much balance does this contract current have</p>
<pre><code class="language-solidity">function getBalance() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>amount in wei</td></tr>
</tbody></table>
<h3 id="getmetadata"><a class="header" href="#getmetadata">getMetadata</a></h3>
<p>gets the metadata of a given pool</p>
<pre><code class="language-solidity">function getMetadata(uint256 _tokenID) external view returns (Metadata memory);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>identifies the pool</td></tr>
</tbody></table>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>Metadata</code></td><td>BlockscapeStaking.Metadata of the pool</td></tr>
</tbody></table>
<h3 id="openvault"><a class="header" href="#openvault">openVault</a></h3>
<p>makes the vault stakable again after it has been closed</p>
<p><em>is triggered when the vault can be staked at rocketpool</em></p>
<pre><code class="language-solidity">function openVault() external onlyRole(EMERGENCY_ROLE);
</code></pre>
<h3 id="_openvaultinternal"><a class="header" href="#_openvaultinternal">_openVaultInternal</a></h3>
<p>opens the vault after the recent Validator data has been updated
and is associated with the recent _tokenID</p>
<pre><code class="language-solidity">function _openVaultInternal() internal;
</code></pre>
<h3 id="closevault"><a class="header" href="#closevault">closeVault</a></h3>
<p>is triggered when the vault can be staked at rocketpool</p>
<p><em>future staking interactions are prevented afterwards</em></p>
<pre><code class="language-solidity">function closeVault() external onlyRole(EMERGENCY_ROLE);
</code></pre>
<h3 id="_closevaultinternal"><a class="header" href="#_closevaultinternal">_closeVaultInternal</a></h3>
<p>closes the vault to temporarily prevent further depositing</p>
<pre><code class="language-solidity">function _closeVaultInternal() internal;
</code></pre>
<h3 id="isvaultopen"><a class="header" href="#isvaultopen">isVaultOpen</a></h3>
<p>does the vault currently allow depositing</p>
<p><em>the backend controller will reopen then vault after the stake
have been transferred</em></p>
<pre><code class="language-solidity">function isVaultOpen() public view returns (bool);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>is depositing enabled</td></tr>
</tbody></table>
<h3 id="changewithdrawfee"><a class="header" href="#changewithdrawfee">changeWithdrawFee</a></h3>
<p>the withdraw fee might be changed in the future, but cannot be higher than 20%</p>
<p><em>only the user with the ADJ_CONFIG_ROLE can call this function</em></p>
<pre><code class="language-solidity">function changeWithdrawFee(uint256 _amount) external onlyRole(ADJ_CONFIG_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>the new fee in wei</td></tr>
</tbody></table>
<h3 id="changetimelockwithdraw"><a class="header" href="#changetimelockwithdraw">changeTimelockWithdraw</a></h3>
<p>the timelock for withdraw might be changed in the future, but cannot be higher than 7 days</p>
<p><em>only the user with the ADJ_CONFIG_ROLE can call this function</em></p>
<pre><code class="language-solidity">function changeTimelockWithdraw(uint256 _newTimelock) external onlyRole(ADJ_CONFIG_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_newTimelock</code></td><td><code>uint256</code></td><td>the new timelock period in days</td></tr>
</tbody></table>
<h3 id="receive"><a class="header" href="#receive">receive</a></h3>
<p>allow contract to receive ETH without making a delegated call</p>
<pre><code class="language-solidity">receive() external payable;
</code></pre>
<h3 id="preparewithdrawalprocess"><a class="header" href="#preparewithdrawalprocess">prepareWithdrawalProcess</a></h3>
<p>allow user to request a withdrawal</p>
<pre><code class="language-solidity">function prepareWithdrawalProcess(uint256 _tokenID) external virtual;
</code></pre>
<h3 id="withdrawfunds"><a class="header" href="#withdrawfunds">withdrawFunds</a></h3>
<p>enable the user to withdraw his/her funds</p>
<pre><code class="language-solidity">function withdrawFunds(uint256 _tokenID) external virtual;
</code></pre>
<h3 id="calcwithdrawfee"><a class="header" href="#calcwithdrawfee">calcWithdrawFee</a></h3>
<p>calculates the withdraw fee for a given user and tokenID</p>
<pre><code class="language-solidity">function calcWithdrawFee(uint256 _tokenID, address _user) public view virtual returns (uint256 _amount);
</code></pre>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="metadata"><a class="header" href="#metadata">Metadata</a></h3>
<p><em>Metadata struct</em></p>
<pre><code class="language-solidity">struct Metadata {
    uint256 stakedETH;
    uint256 stakedTimestamp;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="blockscapeethstakenft"><a class="header" href="#blockscapeethstakenft">BlockscapeETHStakeNFT</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/BlockscapeETHStakeNFT.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
ERC1155Supply, ReentrancyGuard, <a href="src/BlockscapeETHStakeNFT.sol//src/utils/BlockscapeAccess.sol/abstract.BlockscapeAccess.html">BlockscapeAccess</a>, <a href="src/BlockscapeETHStakeNFT.sol//src/utils/BlockscapeShared.sol/abstract.BlockscapeShared.html">BlockscapeShared</a></p>
<p><strong>Author:</strong>
Blockscape Finance AG <a href="mailto:src/BlockscapeETHStakeNFT.sol/info@blockscape.network">info@blockscape.network</a></p>
<p>collects ETH, mints NFT in return for stake, which can be any amount of ETH. The ETH is staked in the blockscape rocketpool infrastructure.</p>
<h2 id="state-variables-2"><a class="header" href="#state-variables-2">State Variables</a></h2>
<h3 id="poolsupply"><a class="header" href="#poolsupply">poolSupply</a></h3>
<p>tracks the ETH pool supply</p>
<pre><code class="language-solidity">uint256 private poolSupply;
</code></pre>
<h3 id="name"><a class="header" href="#name">name</a></h3>
<p>constant used for blockexplorers to display the name of the token (as to be lower case as per blockexplorer standards)</p>
<pre><code class="language-solidity">string public constant name = &quot;Blockscape ETH Stake NFTs&quot;;
</code></pre>
<h3 id="symbol"><a class="header" href="#symbol">symbol</a></h3>
<p>constant used for blockexplorers to display the symbol of the token (as to be lower case as per blockexplorer standards)</p>
<pre><code class="language-solidity">string public constant symbol = &quot;BSS&quot;;
</code></pre>
<h2 id="functions-6"><a class="header" href="#functions-6">Functions</a></h2>
<h3 id="constructor-1"><a class="header" href="#constructor-1">constructor</a></h3>
<p>each pool related vault gets its separate tokenID which depicts
the nft for each staker</p>
<p><em>the IPNS makes sure the nfts stay reachable via this link while
new nfts get added to the underlying ipfs folder</em></p>
<pre><code class="language-solidity">constructor()
    ERC1155(&quot;https://ipfs.blockscape.network/ipns/&quot; &quot;TBD/&quot; &quot;{id}.json&quot;)
    BlockscapeAccess(msg.sender, BlockscapeShared.blockscapeRocketPoolNode, msg.sender);
</code></pre>
<h3 id="supportsinterface"><a class="header" href="#supportsinterface">supportsInterface</a></h3>
<p><em>needed as the OZ ERC1155 &amp;&amp; AccessControl does both implement the supportsInterface function</em></p>
<pre><code class="language-solidity">function supportsInterface(bytes4 interfaceId) public view virtual override(ERC1155, AccessControl) returns (bool);
</code></pre>
<h3 id="depositstakenft"><a class="header" href="#depositstakenft">depositStakeNFT</a></h3>
<p>used by stakers to deposit ETH into the contract</p>
<p><em>the vault must be open and enough RPL must be staked in the rocketpool by the node</em></p>
<p><em>the msg.value must be greater than 0</em></p>
<p><em>the msg.value is added to the poolSupply</em></p>
<p><em>if contract balance is greater than 8 ETH, the ETH is sent to the rocketpool node</em></p>
<pre><code class="language-solidity">function depositStakeNFT() external payable nonReentrant;
</code></pre>
<h3 id="updatestake"><a class="header" href="#updatestake">updateStake</a></h3>
<p>update the stake of the given tokenID, if the NFT owner decides to stake more ETH</p>
<p><em>emits the StakeUpdated event &amp; increases the poolSupply based on the msg.value</em></p>
<pre><code class="language-solidity">function updateStake(uint256 _tokenID) external payable;
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>Identifier of the vault</td></tr>
</tbody></table>
<h3 id="preparewithdrawalprocess-1"><a class="header" href="#preparewithdrawalprocess-1">prepareWithdrawalProcess</a></h3>
<p>Withdraw is a two step process, first the staker has to call prepareWithdrawalProcess()</p>
<p><em>first step used by the staker when he or she wants to unstake</em></p>
<pre><code class="language-solidity">function prepareWithdrawalProcess(uint256 _tokenID) external override;
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>which ETH Stake NFT the staker wants to unstake the backend will listen on the event and will unstake the validator. The ETH value with rewards is transparantly available via beacon chain explorers and will be reduced by the withdraw fee, which is fixed to 0.5% after one year.</td></tr>
</tbody></table>
<h3 id="withdrawfunds-1"><a class="header" href="#withdrawfunds-1">withdrawFunds</a></h3>
<p>used by the staker after prepareWithdrawalProcess() &amp; the timelock has passed to withdraw the funds</p>
<p><em>the rewards are calculated by the backend controller and are then stored in the contract,
this is needed to be able to calculate the rewards correctly including MEV rewards.
There off-chain calculated rewards cannot be lower than the on-chain esimated rewards.</em></p>
<pre><code class="language-solidity">function withdrawFunds(uint256 _tokenID) external override nonReentrant;
</code></pre>
<h3 id="getpoolsupply"><a class="header" href="#getpoolsupply">getPoolSupply</a></h3>
<p>returns the current ETH supply of the pool</p>
<pre><code class="language-solidity">function getPoolSupply() public view returns (uint256);
</code></pre>
<h3 id="calcwithdrawfee-1"><a class="header" href="#calcwithdrawfee-1">calcWithdrawFee</a></h3>
<p>how much fees would the user have to pay if he or she would to unstake now
within the first year of staking the fee is starting at 20% &amp; decreasing linearly, afterwards 0.5%</p>
<pre><code class="language-solidity">function calcWithdrawFee(uint256 _tokenID, address _user) public view override returns (uint256 _amount);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>which NFT the staker wants to unstake</td></tr>
<tr><td><code>_user</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>how much the user would pay on fees in percent*1e18</td></tr>
</tbody></table>
<h3 id="calcapr"><a class="header" href="#calcapr">calcApr</a></h3>
<p>this function is a on-chain calculation of the rocketpool ETH rewards.</p>
<p>It does take MEV (estimated) into account.</p>
<p><em>exp(((31556926 / 384) * 64) / 31622 / sqrt(balanceStaked)) - 1) * 100 - 0.5</em></p>
<p><em>31556926 = seconds per year</em></p>
<p><em>384 = seconds per epoch</em></p>
<p><em>31556926 / 384 = epochs per year</em></p>
<p><em>64 = BASE_REWARD_FACTOR</em></p>
<p><em>31622 = sqrt(gwei per ETH)</em></p>
<p><em>166.32368815e18 = ((31556926 / 384) * 64) / 31622</em></p>
<p><em>0x00000000219ab540356cBB839Cbe05303d7705Fa = deposit contract address</em></p>
<pre><code class="language-solidity">function calcApr() internal view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>rewards annual procentage rate * 1e18</td></tr>
</tbody></table>
<h3 id="calcrewards"><a class="header" href="#calcrewards">calcRewards</a></h3>
<p>calculates the rewards for the staker based on the current APR and the time staked</p>
<pre><code class="language-solidity">function calcRewards(uint256 _tokenID) internal view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>which the rewards are calculated for</td></tr>
</tbody></table>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>ETH rewards in wei minus the withdraw fee</td></tr>
</tbody></table>
<h3 id="totalsupply"><a class="header" href="#totalsupply">totalSupply</a></h3>
<p>how many NFTs are there totally</p>
<pre><code class="language-solidity">function totalSupply() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>total amount of NFTs minted</td></tr>
</tbody></table>
<h3 id="contracturi"><a class="header" href="#contracturi">contractURI</a></h3>
<p>stake nft metdata location</p>
<p><em>this path will never change as the contract defines a collection</em></p>
<pre><code class="language-solidity">function contractURI() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>the fixed collection metadata path</td></tr>
</tbody></table>
<h3 id="uri"><a class="header" href="#uri">uri</a></h3>
<p>gets the url to the metadata of a given NFT tokenID</p>
<pre><code class="language-solidity">function uri(uint256 _tokenID) public pure override returns (string memory);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>the pool</td></tr>
</tbody></table>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>the NFT metadata url</td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="validatoralreadyset"><a class="header" href="#validatoralreadyset">ValidatorAlreadySet</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/BlockscapeValidatorNFT.sol">Git Source</a></p>
<p><strong>Author:</strong>
Blockscape Finance AG <a href="mailto:src/BlockscapeValidatorNFT.sol/info@blockscape.network">info@blockscape.network</a></p>
<p>collects staking, mints NFT in return for staker and let's backend controller
transfer the stake when the pool is full (currently 16 ETH) and enough RPL are available</p>
<p>this implementation relies on a backend controller which is a core component
of the implementation.</p>
<p>error message if a validator is already set</p>
<pre><code class="language-solidity">error ValidatorAlreadySet(address _vali);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="blockscapevalidatornft"><a class="header" href="#blockscapevalidatornft">BlockscapeValidatorNFT</a></h1>
<p><a href="https://github.com/BlockscapeNetwork/rocketscape/blob/c46f2dd75068852009941e7857aca6a55d826b96/src/BlockscapeValidatorNFT.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
ERC1155Supply, ReentrancyGuard, <a href="src/BlockscapeValidatorNFT.sol//src/utils/BlockscapeAccess.sol/abstract.BlockscapeAccess.html">BlockscapeAccess</a>, <a href="src/BlockscapeValidatorNFT.sol//src/utils/BlockscapeShared.sol/abstract.BlockscapeShared.html">BlockscapeShared</a></p>
<h2 id="state-variables-3"><a class="header" href="#state-variables-3">State Variables</a></h2>
<h3 id="name-1"><a class="header" href="#name-1">name</a></h3>
<p>name constant used for blockexplorers (as to be lower case as per blockexplorer standards)</p>
<pre><code class="language-solidity">string public constant name = &quot;Blockscape Validator NFTs&quot;;
</code></pre>
<h3 id="symbol-1"><a class="header" href="#symbol-1">symbol</a></h3>
<p>symbol constant used for blockexplorers (as to be lower case as per blockexplorer standards)</p>
<pre><code class="language-solidity">string public constant symbol = &quot;BSV&quot;;
</code></pre>
<h3 id="curethlimit"><a class="header" href="#curethlimit">curETHlimit</a></h3>
<p>Current Rocketpool Minipool Limit</p>
<pre><code class="language-solidity">uint256 private curETHlimit = 16 ether;
</code></pre>
<h3 id="tokenidtovalidator"><a class="header" href="#tokenidtovalidator">tokenIDtoValidator</a></h3>
<p><em>mapping of tokenID to validator minipool address</em></p>
<pre><code class="language-solidity">mapping(uint256 =&gt; address) private tokenIDtoValidator;
</code></pre>
<h2 id="functions-7"><a class="header" href="#functions-7">Functions</a></h2>
<h3 id="constructor-2"><a class="header" href="#constructor-2">constructor</a></h3>
<p>each validator related vault gets its separate tokenID which depicts
the nft for each staker</p>
<p><em>the IPNS makes sure the nfts stay reachable via this link while
new nfts get added to the underlying ipfs folder</em></p>
<pre><code class="language-solidity">constructor()
    ERC1155(
        &quot;https://ipfs.blockscape.network/ipns/&quot; &quot;k51qzi5uqu5di5eo5fzr1zypdsz0zct39zpct9s4wesjustul1caeofak3zoej/&quot;
        &quot;{id}.json&quot;
    )
    BlockscapeAccess(msg.sender, BlockscapeShared.blockscapeRocketPoolNode, msg.sender);
</code></pre>
<h3 id="supportsinterface-1"><a class="header" href="#supportsinterface-1">supportsInterface</a></h3>
<p><em>needed as the OZ ERC1155 &amp;&amp; AccessControl does both implement the supportsInterface function</em></p>
<pre><code class="language-solidity">function supportsInterface(bytes4 interfaceId) public view virtual override(ERC1155, AccessControl) returns (bool);
</code></pre>
<h3 id="depositvalidatornft"><a class="header" href="#depositvalidatornft">depositValidatorNFT</a></h3>
<p>used by stakers to deposit ETH into the contract</p>
<p><em>the vault must be open and equal the depositing amount</em></p>
<p><em>enought RPL must be staked in the rocketpool by the node</em></p>
<pre><code class="language-solidity">function depositValidatorNFT() external payable;
</code></pre>
<h3 id="withdrawbatch"><a class="header" href="#withdrawbatch">withdrawBatch</a></h3>
<p>this gets triggered by the backend controller when a new token is minted</p>
<p><em>the backend controller is only able to withdraw the current ETH limit</em></p>
<pre><code class="language-solidity">function withdrawBatch() external onlyRole(RP_BACKEND_ROLE) nonReentrant;
</code></pre>
<h3 id="updatevalidator"><a class="header" href="#updatevalidator">updateValidator</a></h3>
<p>update validator address for given token id only once after the NFT has been issued
and the validator was created by the backend
this function will only be called by the backend</p>
<p><em>works only once for a tokenID; it will reopen the vault</em></p>
<p><em>emits no event by design to reduce maintenance costs</em></p>
<pre><code class="language-solidity">function updateValidator(uint256 _tokenID, address _vali) external onlyRole(RP_BACKEND_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>Identifier of the NFT</td></tr>
<tr><td><code>_vali</code></td><td><code>address</code></td><td>the current address of the validator</td></tr>
</tbody></table>
<h3 id="preparewithdrawalprocess-2"><a class="header" href="#preparewithdrawalprocess-2">prepareWithdrawalProcess</a></h3>
<p>Withdraw is a two step process, first the staker has to call prepareWithdrawalProcess()</p>
<p><em>fist step used by the staker when he or she wants to unstake</em></p>
<pre><code class="language-solidity">function prepareWithdrawalProcess(uint256 _tokenID) external override;
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>which validator NFT the staker wants to unstake; the backend will listen on the event and will unstake the validator. The ETH value with rewards is transparantly available via beacon chain explorers and will be reduced by the withdraw fee, which is fixed to 0.5% after one year.</td></tr>
</tbody></table>
<h3 id="withdrawfunds-2"><a class="header" href="#withdrawfunds-2">withdrawFunds</a></h3>
<p>used by the staker after prepareWithdrawalProcess() &amp; the timelock has passed to withdraw the funds</p>
<p><em>the rewards are calculated by the backend controller and are then stored in the contract,
this is needed to be able to calculate the rewards correctly including MEV rewards.</em></p>
<p><em>There off-chain calculated rewards cannot be lower than the on-chain estimated rewards.</em></p>
<pre><code class="language-solidity">function withdrawFunds(uint256 _tokenID) external override;
</code></pre>
<h3 id="calcrewards-1"><a class="header" href="#calcrewards-1">calcRewards</a></h3>
<p>this function is called by the backend controller when the UserRequestedWithdrawal is emited</p>
<p><em>the rewards are calculated by the backend controller and are then stored in the contract,
this is needed to be able to calculate the rewards correctly including MEV rewards.
There off-chain calculated rewards cannot be lower than the on-chain estimated rewards.</em></p>
<pre><code class="language-solidity">function calcRewards(uint256 _tokenID, uint256 _calcReward) public onlyRole(RP_BACKEND_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>the tokenID of the validator</td></tr>
<tr><td><code>_calcReward</code></td><td><code>uint256</code></td><td>the calculated rewards in wei</td></tr>
</tbody></table>
<h3 id="changeethlimit8"><a class="header" href="#changeethlimit8">changeETHLimit8</a></h3>
<p>the limit might change in the future if rocketpool supports
smaller pool sizes (RPIP-8)</p>
<p><em>this function is only callable by our multisig wallet with ADJ_CONFIG_ROLE</em></p>
<p><em>it will only allow to set the limit to 8 ETH</em></p>
<pre><code class="language-solidity">function changeETHLimit8() external onlyRole(ADJ_CONFIG_ROLE);
</code></pre>
<h3 id="lowerrpcommfee8"><a class="header" href="#lowerrpcommfee8">lowerRPCommFee8</a></h3>
<p><em>this function is only callable by our multisig wallet with ADJ_CONFIG_ROLE</em></p>
<p><em>this will set the comission fee for 8 ETH minipools</em></p>
<pre><code class="language-solidity">function lowerRPCommFee8(uint256 _amount) external onlyRole(ADJ_CONFIG_ROLE);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>the new comission</td></tr>
</tbody></table>
<h3 id="getcurrentethlimit"><a class="header" href="#getcurrentethlimit">getCurrentEthLimit</a></h3>
<p>the current depositing threshold</p>
<pre><code class="language-solidity">function getCurrentEthLimit() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>the current ETH limit in wei</td></tr>
</tbody></table>
<h3 id="calcwithdrawfee-2"><a class="header" href="#calcwithdrawfee-2">calcWithdrawFee</a></h3>
<p>how much fees would the user has to pay if he or she would unstake now
within the first year of staking the fee is starting at 20% &amp; decreasing linearly, afterwards 0.5%</p>
<pre><code class="language-solidity">function calcWithdrawFee(uint256 _tokenID, address _user) public view override returns (uint256 _amount);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>which NFT the staker wants to unstake</td></tr>
<tr><td><code>_user</code></td><td><code>address</code></td><td></td></tr>
</tbody></table>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_amount</code></td><td><code>uint256</code></td><td>how much the user would pay on fees in percent*1e18</td></tr>
</tbody></table>
<h3 id="getvalidatoraddress"><a class="header" href="#getvalidatoraddress">getValidatorAddress</a></h3>
<p>this function is used to get the validator address from the tokenID</p>
<pre><code class="language-solidity">function getValidatorAddress(uint256 _tokenID) public view returns (address);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>the tokenID of the NFT</td></tr>
</tbody></table>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>address</code></td><td>the minipool address of the validator</td></tr>
</tbody></table>
<h3 id="estrewardsnomev"><a class="header" href="#estrewardsnomev">estRewardsNoMEV</a></h3>
<p>this function is a on-chain calculation of the rocketpool ETH rewards.
It does not take MEV into account &amp; will only work correctly
after the Shapella/Shanghai upgrade</p>
<pre><code class="language-solidity">function estRewardsNoMEV(uint256 _tokenID) internal view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>tokenID of the NFT, the user wants to unstake</td></tr>
</tbody></table>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>rewards in wei minus the withdraw fee</td></tr>
</tbody></table>
<h3 id="totalsupply-1"><a class="header" href="#totalsupply-1">totalSupply</a></h3>
<p>total amount of supply</p>
<pre><code class="language-solidity">function totalSupply() external view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>total amount of ERC-1155 tokens of the contract</td></tr>
</tbody></table>
<h3 id="contracturi-1"><a class="header" href="#contracturi-1">contractURI</a></h3>
<p>stake nft metdata location</p>
<p><em>this path will never change as the contract defines a collection</em></p>
<pre><code class="language-solidity">function contractURI() external pure returns (string memory);
</code></pre>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>the fixed collection metadata path</td></tr>
</tbody></table>
<h3 id="uri-1"><a class="header" href="#uri-1">uri</a></h3>
<p>gets the url to the metadata of a given pool</p>
<pre><code class="language-solidity">function uri(uint256 _tokenID) public pure override returns (string memory);
</code></pre>
<p><strong>Parameters</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_tokenID</code></td><td><code>uint256</code></td><td>the pool</td></tr>
</tbody></table>
<p><strong>Returns</strong></p>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>string</code></td><td>the url</td></tr>
</tbody></table>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="solidity.min.js"></script>
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
